<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TempMail - Replit Style</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #0e1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-hover: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-primary: #238636;
            --accent-secondary: #1f6feb;
            --border: #30363d;
            --success: #238636;
            --warning: #d29922;
            --error: #f85149;
            --replit-orange: #f26207;
            --replit-blue: #56d8ff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* About Banner - Replit Style */
        .about-banner {
            background: linear-gradient(90deg, var(--replit-orange), var(--replit-blue));
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            position: relative;
            z-index: 1001;
        }

        .banner-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .banner-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Sidebar - Replit Style */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--replit-orange), var(--replit-blue));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .generate-btn {
            width: 100%;
            background: var(--replit-orange);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .generate-btn:hover {
            background: #e55a06;
        }

        .generate-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding: 0 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background-color: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background-color: var(--accent-secondary);
            color: white;
        }

        .nav-item .material-icons {
            font-size: 18px;
        }

        .nav-badge {
            background: var(--success);
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 500;
            margin-left: auto;
        }

        /* Main Content - Replit Style */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
        }

        .header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .icon-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Email Tabs */
        .mailbox-tabs {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .tabs-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tabs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px;
        }

        .mailbox-tab {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            max-width: 200px;
        }

        .mailbox-tab.active {
            background: var(--accent-secondary);
            color: white;
            border-color: var(--accent-secondary);
        }

        .mailbox-tab:hover:not(.active) {
            background: var(--bg-hover);
        }

        .tab-email {
            font-family: 'Courier New', monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: inherit;
        }

        /* Current Email Card */
        .current-email-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .current-email-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--replit-orange), var(--replit-blue));
        }

        .email-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .email-address {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
        }

        .email-actions {
            display: flex;
            gap: 8px;
        }

        .copy-btn, .share-btn {
            background: var(--accent-secondary);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .copy-btn:hover, .share-btn:hover {
            background: #1a5db8;
        }

        .share-btn {
            background: var(--success);
        }

        .share-btn:hover {
            background: #1a7f37;
        }

        .email-info {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .email-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Email List */
        .email-list {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .email-item {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .email-item:hover {
            background: var(--bg-hover);
        }

        .email-item:last-child {
            border-bottom: none;
        }

        .email-item.unread {
            background: rgba(31, 111, 235, 0.05);
            border-left: 3px solid var(--accent-secondary);
        }

        .email-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--replit-orange), var(--replit-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
            flex-shrink: 0;
        }

        .email-content {
            flex: 1;
            min-width: 0;
        }

        .email-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .email-from {
            font-weight: 500;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-time {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
            margin-left: 12px;
        }

        .email-subject {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-preview {
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-to {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            font-family: 'Courier New', monospace;
        }

        /* Email Viewer Modal */
        .email-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 1000;
        }

        .email-viewer.show {
            display: flex;
        }

        .email-viewer-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .email-viewer-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .email-viewer-subject {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .email-viewer-meta {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            font-size: 12px;
        }

        .email-meta-label {
            color: var(--text-muted);
            font-weight: 500;
        }

        .email-meta-value {
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
        }

        .email-viewer-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .email-body-content {
            color: var(--text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .email-body-html {
            background: white;
            color: #000;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .email-viewer-actions {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: var(--bg-tertiary);
        }

        /* About Section */
        .about-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .about-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .about-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .about-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .about-content {
            padding: 20px;
        }

        .about-item {
            margin-bottom: 20px;
        }

        .about-item h3 {
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .about-item p {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .disclaimer-box {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .disclaimer-title {
            color: var(--error);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .disclaimer-text {
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.4;
        }

        .api-info {
            background: rgba(31, 111, 235, 0.1);
            border: 1px solid rgba(31, 111, 235, 0.3);
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }

        .api-info-title {
            color: var(--accent-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-link {
            color: var(--accent-secondary);
            text-decoration: none;
            font-weight: 500;
        }

        .api-link:hover {
            text-decoration: underline;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state .material-icons {
            font-size: 48px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-secondary);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 16px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--accent-secondary);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #1a5db8;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Status Indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-online {
            background: var(--success);
        }

        .status-offline {
            background: var(--text-muted);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--bg-hover);
            border-radius: 50%;
            border-top-color: var(--accent-secondary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px 16px;
            color: var(--text-primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 240px;
            }
            
            .content-area {
                padding: 16px;
            }
            
            .current-email-card {
                padding: 16px;
            }

            .email-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .email-viewer-content {
                margin: 10px;
            }
        }

        @media (max-width: 640px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
            }
            
            .sidebar-nav {
                display: none;
            }
            
            .main-content {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- About Banner -->
    <div class="about-banner" id="about-banner">
        🚀 TempMail Pro - Professional temporary email service powered by mail.tm API with multi-mailbox support
        <button class="banner-close" onclick="closeBanner()">×</button>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">TM</div>
                    <div class="logo-text">TempMail</div>
                </div>
                <button class="generate-btn" onclick="generateNewEmail()" id="generate-btn">
                    <span class="material-icons">add</span>
                    Generate New Email
                </button>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Inbox</div>
                    <div class="nav-item active" onclick="switchTab('inbox')">
                        <span class="material-icons">inbox</span>
                        <span>All Emails</span>
                        <span class="nav-badge" id="inbox-count">0</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('unread')">
                        <span class="material-icons">mark_email_unread</span>
                        <span>Unread</span>
                        <span class="nav-badge" id="unread-count">0</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Mailboxes</div>
                    <div class="nav-item" onclick="switchTab('active')">
                        <span class="material-icons">tab</span>
                        <span>Active Boxes</span>
                        <span class="nav-badge" id="active-count">0</span>
                    </div>
                    <div class="nav-item" onclick="importMailbox()">
                        <span class="material-icons">cloud_download</span>
                        <span>Import Mailbox</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Info</div>
                    <div class="nav-item" onclick="switchTab('about')">
                        <span class="material-icons">info</span>
                        <span>About</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('settings')">
                        <span class="material-icons">settings</span>
                        <span>Settings</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-title" id="page-title">All Emails</div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="refreshEmails()" title="Refresh" id="refresh-btn">
                        <span class="material-icons">refresh</span>
                    </button>
                    <button class="icon-btn" onclick="markAllAsRead()" title="Mark all as read">
                        <span class="material-icons">drafts</span>
                    </button>
                </div>
            </div>

            <div class="content-area">
                <!-- Mailbox Tabs -->
                <div class="mailbox-tabs" id="mailbox-tabs" style="display: none;">
                    <div class="tabs-header">
                        <div class="section-title">
                            <span class="material-icons">tab</span>
                            Active Mailboxes
                        </div>
                    </div>
                    <div class="tabs-container" id="tabs-container">
                        <!-- Tabs will be added dynamically -->
                    </div>
                </div>

                <!-- Current Email Display -->
                <div class="current-email-card" id="current-email-card" style="display: none;">
                    <div class="email-display">
                        <div class="email-address" id="current-email">No active email</div>
                        <div class="email-actions">
                            <button class="copy-btn" onclick="copyCurrentEmail()">
                                <span class="material-icons">content_copy</span>
                                Copy
                            </button>
                            <button class="share-btn" onclick="shareCurrentEmail()">
                                <span class="material-icons">share</span>
                                Share
                            </button>
                        </div>
                    </div>
                    <div class="email-info">
                        <div class="email-info-item">
                            <span class="material-icons">schedule</span>
                            <span>Auto-refresh: <span id="refresh-interval">30s</span></span>
                        </div>
                        <div class="email-info-item">
                            <span class="status-indicator status-online"></span>
                            <span>Active</span>
                        </div>
                        <div class="email-info-item">
                            <span class="material-icons">security</span>
                            <span>Temporary</span>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Content Area -->
                <div id="dynamic-content">
                    <!-- Email List Content -->
                    <div id="inbox-content" class="content-section">
                        <div class="email-list" id="email-list">
                            <div class="empty-state">
                                <span class="material-icons">mail_outline</span>
                                <h3>No emails yet</h3>
                                <p>Generate a temporary email to start receiving messages</p>
                            </div>
                        </div>
                    </div>

                    <!-- Active Mailboxes Content -->
                    <div id="active-content" class="content-section" style="display: none;">
                        <div class="email-list" id="active-mailbox-list">
                            <div class="empty-state">
                                <span class="material-icons">tab</span>
                                <h3>No active mailboxes</h3>
                                <p>Generate or import mailboxes to see them here</p>
                            </div>
                        </div>
                    </div>

                    <!-- About Content -->
                    <div id="about-content" class="content-section" style="display: none;">
                        <div class="about-section">
                            <div class="about-header">
                                <div class="about-title">
                                    <span class="material-icons">info</span>
                                    About TempMail Pro
                                </div>
                                <div class="about-subtitle">Professional temporary email service</div>
                            </div>
                            <div class="about-content">
                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">security</span>
                                        What is TempMail Pro?
                                    </h3>
                                    <p>TempMail Pro is a professional temporary email service that provides you with disposable email addresses for testing, privacy protection, and avoiding spam.</p>
                                </div>

                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">features</span>
                                        Features
                                    </h3>
                                    <p>• Multi-mailbox support with tabbed interface</p>
                                    <p>• Real-time email monitoring and notifications</p>
                                    <p>• Import and share mailboxes via links</p>
                                    <p>• Clean, Replit-inspired user interface</p>
                                    <p>• No registration required</p>
                                </div>

                                <div class="api-info">
                                    <div class="api-info-title">
                                        <span class="material-icons">cloud</span>
                                        Powered by mail.tm API
                                    </div>
                                    <p>This service uses the free mail.tm API to provide temporary email functionality. Visit <a href="https://mail.tm" target="_blank" class="api-link">mail.tm</a> for more information about the underlying service.</p>
                                </div>

                                <div class="disclaimer-box">
                                    <div class="disclaimer-title">
                                        <span class="material-icons">warning</span>
                                        Important Disclaimer
                                    </div>
                                    <div class="disclaimer-text">
                                        <p><strong>We do not own, operate, or control the mail.tm service.</strong></p>
                                        <p>• This website is simply a user interface wrapper around the mail.tm API</p>
                                        <p>• We do not store, process, or have access to any email data</p>
                                        <p>• All emails are handled directly by mail.tm servers</p>
                                        <p>• Use of this service is subject to mail.tm's terms and conditions</p>
                                        <p>• We are not responsible for any data loss, privacy breaches, or service interruptions</p>
                                        <p>• This service is provided "as-is" without any warranties</p>
                                    </div>
                                </div>

                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">privacy_tip</span>
                                        Privacy & Security
                                    </h3>
                                    <p>• Temporary emails expire automatically</p>
                                    <p>• No personal information required</p>
                                    <p>• All data is handled by mail.tm infrastructure</p>
                                    <p>• Use only for non-sensitive communications</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Content -->
                    <div id="settings-content" class="content-section" style="display: none;">
                        <div class="about-section">
                            <div class="about-header">
                                <div class="about-title">
                                    <span class="material-icons">settings</span>
                                    Settings
                                </div>
                                <div class="about-subtitle">Configure your preferences</div>
                            </div>
                            <div class="about-content">
                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">notifications</span>
                                        Notifications
                                    </h3>
                                    <p>Email notifications are handled by your browser. Enable browser notifications to get alerts for new emails.</p>
                                </div>

                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">refresh</span>
                                        Auto Refresh
                                    </h3>
                                    <p>Emails are automatically refreshed every 30 seconds when you have active mailboxes.</p>
                                </div>

                                <div class="about-item">
                                    <h3>
                                        <span class="material-icons">storage</span>
                                        Data Storage
                                    </h3>
                                    <p>Your mailbox data is stored locally in your browser. Clear your browser data to remove all saved mailboxes.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Viewer Modal -->
    <div class="email-viewer" id="email-viewer">
        <div class="email-viewer-content">
            <div class="email-viewer-header">
                <div class="email-viewer-subject" id="viewer-subject">Email Subject</div>
                <div class="email-viewer-meta">
                    <div class="email-meta-label">From:</div>
                    <div class="email-meta-value" id="viewer-from">sender@example.com</div>
                    <div class="email-meta-label">To:</div>
                    <div class="email-meta-value" id="viewer-to">recipient@example.com</div>
                    <div class="email-meta-label">Date:</div>
                    <div class="email-meta-value" id="viewer-date">2024-01-01 12:00:00</div>
                </div>
            </div>
            <div class="email-viewer-body">
                <div class="email-body-content" id="viewer-body">Email content will appear here...</div>
            </div>
            <div class="email-viewer-actions">
                <button class="btn btn-secondary" onclick="closeEmailViewer()">
                    <span class="material-icons">close</span>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Import Mailbox Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Import Mailbox</div>
                <button class="modal-close" onclick="closeImportModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-input" id="import-email" placeholder="Enter email address">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="import-password" placeholder="Enter password">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="performImport()">
                    <span class="material-icons">cloud_download</span>
                    Import
                </button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Share Mailbox</div>
                <button class="modal-close" onclick="closeShareModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Share Link</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" class="form-input" id="share-link" readonly>
                    <button class="btn btn-primary" onclick="copyShareLink()">
                        <span class="material-icons">content_copy</span>
                        Copy
                    </button>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeShareModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables - FIXED initialization
        let mailAccounts = [];
        let currentAccount = null;
        let allEmails = [];
        let currentTab = 'inbox';
        let refreshInterval = null;
        let isRefreshing = false;

        // Mail.tm API configuration
        const API_BASE = 'https://api.mail.tm';

        // Initialize the application - FIXED
        function initializeApp() {
            try {
                console.log('Initializing TempMail app...');
                loadStoredData();
                updateUI();
                startAutoRefresh();
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Failed to initialize app: ' + error.message, 'error');
            }
        }

        // Load data from localStorage - FIXED
        function loadStoredData() {
            try {
                const stored = localStorage.getItem('tempmail-data');
                if (stored) {
                    const data = JSON.parse(stored);
                    // Ensure arrays are properly initialized
                    mailAccounts = Array.isArray(data.mailAccounts) ? data.mailAccounts : [];
                    allEmails = Array.isArray(data.allEmails) ? data.allEmails : [];
                    
                    // Set current account if exists
                    if (data.currentAccount && mailAccounts.length > 0) {
                        currentAccount = mailAccounts.find(acc => acc.id === data.currentAccount.id) || mailAccounts[0];
                    }
                }
                console.log('Loaded data:', { mailAccounts: mailAccounts.length, allEmails: allEmails.length });
            } catch (error) {
                console.error('Error loading stored data:', error);
                // Reset to defaults on error
                mailAccounts = [];
                allEmails = [];
                currentAccount = null;
            }
        }

        // Save data to localStorage - FIXED
        function saveData() {
            try {
                const data = {
                    mailAccounts: mailAccounts || [],
                    allEmails: allEmails || [],
                    currentAccount: currentAccount
                };
                localStorage.setItem('tempmail-data', JSON.stringify(data));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Generate a new temporary email - FIXED
        async function generateNewEmail() {
            try {
                console.log('Generating new email...');
                const generateBtn = document.getElementById('generate-btn');
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="loading"></span> Generating...';

                // Get available domains
                const domains = await getAvailableDomains();
                if (!domains || domains.length === 0) {
                    throw new Error('No domains available');
                }

                // Create random email
                const randomString = Math.random().toString(36).substring(2, 10);
                const email = `${randomString}@${domains[0].domain}`;
                const password = Math.random().toString(36).substring(2, 15);

                // Register account
                const account = await registerAccount(email, password);
                
                // Get auth token
                const token = await getAuthToken(email, password);
                account.token = token;

                // Add to accounts
                mailAccounts.push(account);
                currentAccount = account;

                updateUI();
                saveData();
                showToast('Email generated successfully!', 'success');
                
                // Start fetching emails for this account
                await refreshEmails();
                
            } catch (error) {
                console.error('Error generating email:', error);
                showToast('Failed to generate email: ' + error.message, 'error');
            } finally {
                const generateBtn = document.getElementById('generate-btn');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span class="material-icons">add</span> Generate New Email';
            }
        }

        // Get available domains from mail.tm API - FIXED
        async function getAvailableDomains() {
            try {
                const response = await fetch(`${API_BASE}/domains`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                return data['hydra:member'] || [];
            } catch (error) {
                console.error('Error fetching domains:', error);
                throw error;
            }
        }

        // Register account with mail.tm API - FIXED
        async function registerAccount(email, password) {
            try {
                const response = await fetch(`${API_BASE}/accounts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        address: email,
                        password: password
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Registration failed: ${response.status}`);
                }

                const account = await response.json();
                account.password = password; // Store password for token renewal
                account.createdAt = new Date().toISOString();
                
                return account;
            } catch (error) {
                console.error('Error registering account:', error);
                throw error;
            }
        }

        // Get authentication token - FIXED
        async function getAuthToken(email, password) {
            try {
                const response = await fetch(`${API_BASE}/token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        address: email,
                        password: password
                    })
                });

                if (!response.ok) {
                    throw new Error(`Authentication failed: ${response.status}`);
                }

                const data = await response.json();
                return data.token;
            } catch (error) {
                console.error('Error getting auth token:', error);
                throw error;
            }
        }

        // Refresh emails for all accounts - FIXED
        async function refreshEmails() {
            if (isRefreshing || mailAccounts.length === 0) {
                return;
            }

            try {
                isRefreshing = true;
                const refreshBtn = document.getElementById('refresh-btn');
                if (refreshBtn) {
                    refreshBtn.disabled = true;
                }

                console.log('Refreshing emails for', mailAccounts.length, 'accounts');

                for (const account of mailAccounts) {
                    if (account && account.token) {
                        try {
                            await fetchEmailsForAccount(account);
                        } catch (error) {
                            console.error(`Error fetching emails for ${account.address}:`, error);
                        }
                    }
                }

                updateUI();
                saveData();
                
            } catch (error) {
                console.error('Error refreshing emails:', error);
                showToast('Failed to refresh emails: ' + error.message, 'error');
            } finally {
                isRefreshing = false;
                const refreshBtn = document.getElementById('refresh-btn');
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                }
            }
        }

        // Fetch emails for a specific account - FIXED
        async function fetchEmailsForAccount(account) {
            try {
                const response = await fetch(`${API_BASE}/messages`, {
                    headers: {
                        'Authorization': `Bearer ${account.token}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        // Token expired, try to refresh
                        account.token = await getAuthToken(account.address, account.password);
                        return await fetchEmailsForAccount(account);
                    }
                    throw new Error(`Failed to fetch emails: ${response.status}`);
                }

                const data = await response.json();
                const messages = data['hydra:member'] || [];

                // Process and store emails
                for (const message of messages) {
                    const existingEmail = allEmails.find(e => e.id === message.id);
                    if (!existingEmail) {
                        message.accountEmail = account.address;
                        message.isRead = false;
                        allEmails.push(message);
                    }
                }

                console.log(`Fetched ${messages.length} emails for ${account.address}`);
                
            } catch (error) {
                console.error(`Error fetching emails for account ${account.address}:`, error);
                throw error;
            }
        }

        // Update UI elements - FIXED
        function updateUI() {
            try {
                updateCounts();
                updateActiveMailboxes();
                updateEmailList();
                updateCurrentEmailDisplay();
                console.log('UI updated successfully');
            } catch (error) {
                console.error('Error updating UI:', error);
            }
        }

        // Update email counts - FIXED
        function updateCounts() {
            try {
                const inboxCount = allEmails ? allEmails.length : 0;
                const unreadCount = allEmails ? allEmails.filter(email => !email.isRead).length : 0;
                const activeCount = mailAccounts ? mailAccounts.length : 0;

                const inboxCountEl = document.getElementById('inbox-count');
                const unreadCountEl = document.getElementById('unread-count');
                const activeCountEl = document.getElementById('active-count');

                if (inboxCountEl) inboxCountEl.textContent = inboxCount;
                if (unreadCountEl) unreadCountEl.textContent = unreadCount;
                if (activeCountEl) activeCountEl.textContent = activeCount;
                
            } catch (error) {
                console.error('Error updating counts:', error);
            }
        }

        // Update active mailboxes display - FIXED
        function updateActiveMailboxes() {
            try {
                const tabsContainer = document.getElementById('tabs-container');
                const mailboxTabs = document.getElementById('mailbox-tabs');
                
                if (!tabsContainer || !mailboxTabs) return;

                if (!mailAccounts || mailAccounts.length === 0) {
                    mailboxTabs.style.display = 'none';
                    return;
                }

                mailboxTabs.style.display = 'block';
                tabsContainer.innerHTML = '';

                mailAccounts.forEach((account, index) => {
                    if (!account || !account.address) return;

                    const tab = document.createElement('div');
                    tab.className = `mailbox-tab ${currentAccount && currentAccount.id === account.id ? 'active' : ''}`;
                    
                    tab.innerHTML = `
                        <span class="tab-email">${account.address}</span>
                        <button class="tab-close" onclick="removeAccount('${account.id}')" title="Remove">×</button>
                    `;
                    
                    tab.onclick = (e) => {
                        if (!e.target.classList.contains('tab-close')) {
                            setCurrentAccount(account.id);
                        }
                    };
                    
                    tabsContainer.appendChild(tab);
                });
                
            } catch (error) {
                console.error('Error updating active mailboxes:', error);
            }
        }

        // Update email list display - FIXED
        function updateEmailList() {
            try {
                const emailList = document.getElementById('email-list');
                if (!emailList) return;

                let emailsToShow = [];

                if (currentTab === 'inbox') {
                    emailsToShow = allEmails || [];
                } else if (currentTab === 'unread') {
                    emailsToShow = allEmails ? allEmails.filter(email => !email.isRead) : [];
                }

                if (emailsToShow.length === 0) {
                    emailList.innerHTML = `
                        <div class="empty-state">
                            <span class="material-icons">mail_outline</span>
                            <h3>No emails ${currentTab === 'unread' ? 'unread' : 'yet'}</h3>
                            <p>${currentTab === 'unread' ? 'All emails have been read' : 'Generate a temporary email to start receiving messages'}</p>
                        </div>
                    `;
                    return;
                }

                // Sort emails by date (newest first)
                emailsToShow.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                emailList.innerHTML = emailsToShow.map(email => {
                    const fromName = email.from?.name || email.from?.address || 'Unknown';
                    const fromAddress = email.from?.address || '';
                    const subject = email.subject || 'No Subject';
                    const preview = email.intro || 'No preview available';
                    const date = new Date(email.createdAt).toLocaleDateString();
                    const time = new Date(email.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const avatar = fromName.charAt(0).toUpperCase();

                    return `
                        <div class="email-item ${email.isRead ? '' : 'unread'}" onclick="openEmail('${email.id}')">
                            <div class="email-avatar">${avatar}</div>
                            <div class="email-content">
                                <div class="email-header">
                                    <div class="email-from">${fromName}</div>
                                    <div class="email-time">${time}</div>
                                </div>
                                <div class="email-subject">${subject}</div>
                                <div class="email-preview">${preview}</div>
                                <div class="email-to">to: ${email.accountEmail}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error updating email list:', error);
            }
        }

        // Update current email display - FIXED
        function updateCurrentEmailDisplay() {
            try {
                const currentEmailCard = document.getElementById('current-email-card');
                const currentEmailEl = document.getElementById('current-email');
                
                if (!currentEmailCard || !currentEmailEl) return;

                if (!currentAccount) {
                    currentEmailCard.style.display = 'none';
                    return;
                }

                currentEmailCard.style.display = 'block';
                currentEmailEl.textContent = currentAccount.address || 'No active email';
                
            } catch (error) {
                console.error('Error updating current email display:', error);
            }
        }

        // Open email viewer - FIXED
        async function openEmail(emailId) {
            try {
                const email = allEmails.find(e => e.id === emailId);
                if (!email) {
                    showToast('Email not found', 'error');
                    return;
                }

                // Mark as read
                email.isRead = true;
                updateUI();
                saveData();

                // Get full email content
                const account = mailAccounts.find(acc => acc.address === email.accountEmail);
                if (!account || !account.token) {
                    showToast('Account not found', 'error');
                    return;
                }

                const response = await fetch(`${API_BASE}/messages/${emailId}`, {
                    headers: {
                        'Authorization': `Bearer ${account.token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch email content');
                }

                const fullEmail = await response.json();

                // Display email
                document.getElementById('viewer-subject').textContent = fullEmail.subject || 'No Subject';
                document.getElementById('viewer-from').textContent = fullEmail.from?.address || 'Unknown';
                document.getElementById('viewer-to').textContent = fullEmail.to?.[0]?.address || email.accountEmail;
                document.getElementById('viewer-date').textContent = new Date(fullEmail.createdAt).toLocaleString();
                
                const bodyContent = document.getElementById('viewer-body');
                if (fullEmail.html) {
                    bodyContent.innerHTML = `<div class="email-body-html">${fullEmail.html}</div>`;
                } else {
                    bodyContent.innerHTML = `<div class="email-body-content">${fullEmail.text || 'No content'}</div>`;
                }

                document.getElementById('email-viewer').classList.add('show');
                
            } catch (error) {
                console.error('Error opening email:', error);
                showToast('Failed to open email: ' + error.message, 'error');
            }
        }

        // Close email viewer - FIXED
        function closeEmailViewer() {
            document.getElementById('email-viewer').classList.remove('show');
        }

        // Set current account - FIXED
        function setCurrentAccount(accountId) {
            try {
                const account = mailAccounts.find(acc => acc.id === accountId);
                if (account) {
                    currentAccount = account;
                    updateUI();
                    saveData();
                }
            } catch (error) {
                console.error('Error setting current account:', error);
            }
        }

        // Remove account - FIXED
        function removeAccount(accountId) {
            try {
                mailAccounts = mailAccounts.filter(acc => acc.id !== accountId);
                allEmails = allEmails.filter(email => {
                    const account = mailAccounts.find(acc => acc.address === email.accountEmail);
                    return account !== undefined;
                });
                
                if (currentAccount && currentAccount.id === accountId) {
                    currentAccount = mailAccounts.length > 0 ? mailAccounts[0] : null;
                }
                
                updateUI();
                saveData();
                showToast('Mailbox removed', 'success');
            } catch (error) {
                console.error('Error removing account:', error);
                showToast('Failed to remove mailbox', 'error');
            }
        }

        // Copy current email address - FIXED
        async function copyCurrentEmail() {
            if (!currentAccount) {
                showToast('No active email to copy', 'error');
                return;
            }

            try {
                await navigator.clipboard.writeText(currentAccount.address);
                showToast('Email copied to clipboard!', 'success');
            } catch (error) {
                console.error('Error copying email:', error);
                showToast('Failed to copy email', 'error');
            }
        }

        // Share current email - FIXED
        function shareCurrentEmail() {
            if (!currentAccount) {
                showToast('No active email to share', 'error');
                return;
            }

            try {
                const shareData = {
                    email: currentAccount.address,
                    password: currentAccount.password,
                    id: currentAccount.id
                };
                
                const shareLink = `${window.location.origin}${window.location.pathname}?import=${btoa(JSON.stringify(shareData))}`;
                
                document.getElementById('share-link').value = shareLink;
                document.getElementById('share-modal').classList.add('show');
            } catch (error) {
                console.error('Error creating share link:', error);
                showToast('Failed to create share link', 'error');
            }
        }

        // Copy share link - FIXED
        async function copyShareLink() {
            try {
                const shareLink = document.getElementById('share-link').value;
                await navigator.clipboard.writeText(shareLink);
                showToast('Share link copied!', 'success');
            } catch (error) {
                console.error('Error copying share link:', error);
                showToast('Failed to copy share link', 'error');
            }
        }

        // Close share modal - FIXED
        function closeShareModal() {
            document.getElementById('share-modal').classList.remove('show');
        }

        // Import mailbox - FIXED
        function importMailbox() {
            document.getElementById('import-modal').classList.add('show');
        }

        // Close import modal - FIXED
        function closeImportModal() {
            document.getElementById('import-modal').classList.remove('show');
            document.getElementById('import-email').value = '';
            document.getElementById('import-password').value = '';
        }

        // Perform import - FIXED
        async function performImport() {
            try {
                const email = document.getElementById('import-email').value.trim();
                const password = document.getElementById('import-password').value.trim();

                if (!email || !password) {
                    showToast('Please enter both email and password', 'error');
                    return;
                }

                // Check if already exists
                if (mailAccounts.find(acc => acc.address === email)) {
                    showToast('Mailbox already exists', 'error');
                    return;
                }

                // Try to authenticate
                const token = await getAuthToken(email, password);
                
                // Create account object
                const account = {
                    id: email,
                    address: email,
                    password: password,
                    token: token,
                    createdAt: new Date().toISOString()
                };

                mailAccounts.push(account);
                currentAccount = account;

                updateUI();
                saveData();
                closeImportModal();
                showToast('Mailbox imported successfully!', 'success');

                // Fetch emails for imported account
                await refreshEmails();
                
            } catch (error) {
                console.error('Error importing mailbox:', error);
                showToast('Failed to import mailbox: ' + error.message, 'error');
            }
        }

        // Switch tab - FIXED
        function switchTab(tab) {
            try {
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                event.currentTarget.classList.add('active');

                // Hide all content sections
                document.querySelectorAll('.content-section').forEach(section => {
                    section.style.display = 'none';
                });

                // Show selected content
                const contentId = tab + '-content';
                const contentEl = document.getElementById(contentId);
                if (contentEl) {
                    contentEl.style.display = 'block';
                }

                // Update page title
                const pageTitleEl = document.getElementById('page-title');
                if (pageTitleEl) {
                    const titles = {
                        'inbox': 'All Emails',
                        'unread': 'Unread Emails',
                        'active': 'Active Mailboxes',
                        'about': 'About & Legal',
                        'settings': 'Settings'
                    };
                    pageTitleEl.textContent = titles[tab] || 'TempMail';
                }

                currentTab = tab;
                updateUI();
                
            } catch (error) {
                console.error('Error switching tab:', error);
            }
        }

        // Mark all as read - FIXED
        function markAllAsRead() {
            try {
                if (!allEmails || allEmails.length === 0) {
                    showToast('No emails to mark as read', 'error');
                    return;
                }

                allEmails.forEach(email => {
                    email.isRead = true;
                });

                updateUI();
                saveData();
                showToast('All emails marked as read', 'success');
            } catch (error) {
                console.error('Error marking all as read:', error);
                showToast('Failed to mark emails as read', 'error');
            }
        }

        // Start auto refresh - FIXED
        function startAutoRefresh() {
            try {
                // Clear existing interval
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }

                // Start new interval
                refreshInterval = setInterval(() => {
                    if (mailAccounts.length > 0 && !isRefreshing) {
                        refreshEmails();
                    }
                }, 30000); // 30 seconds

                console.log('Auto refresh started');
            } catch (error) {
                console.error('Error starting auto refresh:', error);
            }
        }

        // Close banner - FIXED
        function closeBanner() {
            document.getElementById('about-banner').style.display = 'none';
        }

        // Show toast notification - FIXED
        function showToast(message, type = 'info') {
            try {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);

                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 100);

                // Remove after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            } catch (error) {
                console.error('Error showing toast:', error);
            }
        }

        // Handle URL import parameter - FIXED
        function handleURLImport() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const importData = urlParams.get('import');
                
                if (importData) {
                    try {
                        const shareData = JSON.parse(atob(importData));
                        document.getElementById('import-email').value = shareData.email || '';
                        document.getElementById('import-password').value = shareData.password || '';
                        importMailbox();
                        
                        // Clean URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    } catch (error) {
                        console.error('Error parsing import data:', error);
                        showToast('Invalid import link', 'error');
                    }
                }
            } catch (error) {
                console.error('Error handling URL import:', error);
            }
        }

        // Initialize when DOM is loaded - FIXED
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('DOM loaded, initializing app...');
                handleURLImport();
                initializeApp();
            } catch (error) {
                console.error('Error during initialization:', error);
                showToast('Failed to initialize application', 'error');
            }
        });

        // Handle page unload - FIXED
        window.addEventListener('beforeunload', function() {
            try {
                saveData();
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            } catch (error) {
                console.error('Error during page unload:', error);
            }
        });
    </script>
</body>
</html>